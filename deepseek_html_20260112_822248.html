<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeonTalk</title>
    <style>
        :root {
            --primary: #00ff9d;
            --secondary: #7700ff;
            --bg-dark: #0a0a0f;
            --bg-light: #1a1a24;
            --bg-lighter: #2a2a35;
            --text: #ffffff;
            --text-muted: #a0a0b0;
            --danger: #ff5555;
            --success: #00cc66;
            --warning: #ffaa00;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--bg-dark);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* –ó–∞–≥—Ä—É–∑—á–∏–∫ */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid var(--text-muted);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-light);
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1001;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }
        
        .notification.error {
            border-left-color: var(--danger);
        }
        
        .notification.success {
            border-left-color: var(--success);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* –≠–∫—Ä–∞–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ */
        #auth-screen {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #050508, var(--bg-dark));
            padding: 20px;
        }
        
        .auth-box {
            background: var(--bg-light);
            padding: 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .logo {
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: var(--bg-lighter);
            border-radius: 12px;
            padding: 5px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .tab.active {
            background: var(--primary);
            color: var(--bg-dark);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            background: var(--bg-lighter);
            border: 2px solid transparent;
            border-radius: 10px;
            color: var(--text);
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn {
            padding: 15px;
            background: var(--primary);
            color: var(--bg-dark);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 157, 0.3);
        }
        
        .btn-google {
            background: white;
            color: #333;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ */
        .main-app {
            display: flex;
            height: 100vh;
        }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            width: 320px;
            background: var(--bg-light);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }
        
        .user-header {
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid var(--bg-lighter);
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }
        
        .user-info h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .status {
            font-size: 13px;
            color: var(--primary);
        }
        
        .search {
            padding: 20px;
            border-bottom: 1px solid var(--bg-lighter);
        }
        
        .search input {
            width: 100%;
            padding: 12px 20px;
            background: var(--bg-lighter);
            border: 2px solid transparent;
            border-radius: 25px;
            color: var(--text);
            font-size: 14px;
        }
        
        .chats-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .chat-item {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s;
            margin-bottom: 5px;
        }
        
        .chat-item:hover {
            background: var(--bg-lighter);
        }
        
        .chat-item.active {
            background: linear-gradient(135deg, rgba(0, 255, 157, 0.1), rgba(119, 0, 255, 0.1));
        }
        
        /* –û–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 20px 30px;
            background: var(--bg-light);
            border-bottom: 1px solid var(--bg-lighter);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .partner-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--bg-dark);
        }
        
        .message {
            max-width: 70%;
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 15px;
            position: relative;
        }
        
        .message.sent {
            margin-left: auto;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--bg-dark);
        }
        
        .message.received {
            margin-right: auto;
            background: var(--bg-lighter);
        }
        
        .message-time {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 5px;
            text-align: right;
        }
        
        .message-input-area {
            padding: 20px;
            background: var(--bg-light);
            display: flex;
            gap: 10px;
        }
        
        .message-input-area input {
            flex: 1;
            padding: 15px;
            background: var(--bg-lighter);
            border: none;
            border-radius: 25px;
            color: var(--text);
            font-size: 16px;
        }
        
        .send-btn {
            background: var(--primary);
            color: var(--bg-dark);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: var(--bg-light);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--bg-lighter);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .settings-item {
            margin-bottom: 20px;
        }
        
        .settings-item label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-muted);
        }
        
        .settings-actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        .btn-secondary {
            background: var(--bg-lighter);
            color: var(--text);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                z-index: 100;
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .message {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading">
        <div class="loader"></div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notification-container"></div>

    <!-- –≠–∫—Ä–∞–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div id="auth-screen" class="hidden">
        <div class="auth-box">
            <div class="logo">NeonTalk</div>
            <div class="tabs">
                <button class="tab active" data-tab="login">–í—Ö–æ–¥</button>
                <button class="tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <input type="email" id="login-email" placeholder="Email" required>
                    <div class="error-message" id="login-email-error"></div>
                </div>
                <div class="form-group">
                    <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    <div class="error-message" id="login-password-error"></div>
                </div>
                <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
                <div class="error-message" id="login-error"></div>
            </form>
            
            <form id="register-form" class="hidden">
                <div class="form-group">
                    <input type="text" id="register-username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
                    <div class="error-message" id="register-username-error"></div>
                </div>
                <div class="form-group">
                    <input type="text" id="register-handle" placeholder="@–Ω–∏–∫–Ω–µ–π–º" required>
                    <div class="error-message" id="register-handle-error"></div>
                </div>
                <div class="form-group">
                    <input type="email" id="register-email" placeholder="Email" required>
                    <div class="error-message" id="register-email-error"></div>
                </div>
                <div class="form-group">
                    <input type="password" id="register-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                    <div class="error-message" id="register-password-error"></div>
                </div>
                <div class="form-group">
                    <input type="password" id="register-confirm" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                    <div class="error-message" id="register-confirm-error"></div>
                </div>
                <button type="submit" class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <div class="error-message" id="register-error"></div>
            </form>
            
            <button id="google-login" class="btn btn-google">
                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
            </button>
            
            <div style="text-align: center; margin-top: 20px;">
                <a href="#" id="forgot-password" style="color: var(--primary); font-size: 14px;">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="main-app" class="main-app hidden">
        <aside class="sidebar">
            <div class="user-header">
                <img id="user-avatar" class="user-avatar" src="" alt="–ê–≤–∞—Ç–∞—Ä">
                <div class="user-info">
                    <h3 id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
                    <div class="status" id="user-status">online</div>
                </div>
                <button id="menu-toggle" style="margin-left: auto; background: none; border: none; color: var(--text); font-size: 20px; cursor: pointer;">
                    ‚ò∞
                </button>
            </div>
            
            <div class="search">
                <input type="text" id="search-users" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...">
            </div>
            
            <div class="chats-list" id="chats-list">
                <!-- –ß–∞—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
            
            <div style="padding: 20px; border-top: 1px solid var(--bg-lighter);">
                <button id="new-chat-btn" class="btn" style="margin-bottom: 10px;">–ù–æ–≤—ã–π —á–∞—Ç</button>
                <button id="settings-btn" class="btn btn-secondary">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button id="logout-btn" class="btn" style="background: var(--danger); margin-top: 10px;">–í—ã–π—Ç–∏</button>
            </div>
        </aside>

        <main class="chat-area">
            <header class="chat-header">
                <div class="partner-info">
                    <img id="partner-avatar" class="user-avatar" src="" alt="–ê–≤–∞—Ç–∞—Ä">
                    <div>
                        <h3 id="partner-name">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h3>
                        <div id="typing-indicator" style="font-size: 12px; color: var(--primary);"></div>
                    </div>
                </div>
            </header>
            
            <div class="messages-container" id="messages-container">
                <div id="messages-list">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <div class="message-input-area">
                <input type="text" id="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled>
                <button class="send-btn" id="send-btn" disabled>‚û§</button>
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</h2>
                <button id="close-settings" style="background: none; border: none; color: var(--text); font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            <div class="modal-body">
                <div class="settings-item">
                    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="settings-username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    <div class="error-message" id="settings-username-error"></div>
                </div>
                
                <div class="settings-item">
                    <label>–ù–∏–∫–Ω–µ–π–º (@handle)</label>
                    <input type="text" id="settings-handle" placeholder="@–Ω–∏–∫–Ω–µ–π–º">
                    <div class="error-message" id="settings-handle-error"></div>
                </div>
                
                <div class="settings-item">
                    <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä</label>
                    <input type="text" id="settings-avatar" placeholder="https://example.com/avatar.jpg">
                    <div class="error-message" id="settings-avatar-error"></div>
                </div>
                
                <div class="settings-item">
                    <label>–°—Ç–∞—Ç—É—Å</label>
                    <select id="settings-status" style="width: 100%; padding: 12px; background: var(--bg-lighter); border: none; border-radius: 8px; color: var(--text);">
                        <option value="online">üü¢ Online</option>
                        <option value="away">üü° Away</option>
                        <option value="busy">üî¥ Busy</option>
                        <option value="offline">‚ö´ Offline</option>
                    </select>
                </div>
                
                <div class="settings-actions">
                    <button id="save-settings" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button id="cancel-settings" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <script>
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE ==========
        const firebaseConfig = {
            apiKey: "AIzaSyB6Kv0GXej0CuSJ6H527t2zAkq6YXHcaVU",
            authDomain: "neontalk-69d61.firebaseapp.com",
            projectId: "neontalk-69d61",
            storageBucket: "neontalk-69d61.firebasestorage.app",
            messagingSenderId: "993129559558",
            appId: "1:993129559558:web:608eb4cd2c6058b36bb587"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let currentUser = null;
        let currentChatId = null;
        let messageListener = null;
        
        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }
        
        function clearErrors(formId) {
            document.querySelectorAll(`#${formId} .error-message`).forEach(el => {
                el.textContent = '';
                el.style.display = 'none';
            });
        }
        
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }
        
        // ========== –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø ==========
        function initAuth() {
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    await loadUserData(user.uid);
                    showMainApp();
                    updateUserStatus('online');
                } else {
                    showAuthScreen();
                }
                hideLoading();
            });
        }
        
        async function loadUserData(userId) {
            const userDoc = await db.collection('users').doc(userId).get();
            if (!userDoc.exists) {
                // –°–æ–∑–¥–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await db.collection('users').doc(userId).set({
                    uid: userId,
                    email: currentUser.email,
                    displayName: currentUser.displayName || currentUser.email.split('@')[0],
                    handle: '@' + currentUser.email.split('@')[0],
                    photoURL: currentUser.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.email.split('@')[0])}&background=00ff9d&color=000`,
                    status: 'online',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            
            updateUserUI();
            loadChats();
        }
        
        function updateUserUI() {
            if (currentUser) {
                document.getElementById('user-name').textContent = currentUser.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('user-avatar').src = currentUser.photoURL || 'https://ui-avatars.com/api/?name=User&background=00ff9d&color=000';
            }
        }
        
        async function updateUserStatus(status) {
            if (!currentUser) return;
            
            await db.collection('users').doc(currentUser.uid).update({
                status: status,
                lastSeen: firebase.firestore.FieldValue.serverTimestamp()
            });
        }
        
        // ========== UI –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        function initUI() {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    document.getElementById('login-form').classList.toggle('hidden', tabName !== 'login');
                    document.getElementById('register-form').classList.toggle('hidden', tabName !== 'register');
                    
                    clearErrors('login-form');
                    clearErrors('register-form');
                });
            });
            
            // –í—Ö–æ–¥
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                clearErrors('login-form');
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                if (!email || !password) {
                    showError('login-error', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }
                
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    showError('login-error', getAuthErrorMessage(error.code));
                }
            });
            
            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            document.getElementById('register-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                clearErrors('register-form');
                
                const username = document.getElementById('register-username').value.trim();
                const handle = document.getElementById('register-handle').value.trim();
                const email = document.getElementById('register-email').value.trim();
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è
                if (!username || !handle || !email || !password || !confirm) {
                    showError('register-error', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }
                
                if (password.length < 6) {
                    showError('register-password-error', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤');
                    return;
                }
                
                if (password !== confirm) {
                    showError('register-confirm-error', '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                    return;
                }
                
                if (!handle.startsWith('@')) {
                    showError('register-handle-error', '–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ handle
                const handleExists = await checkHandleExists(handle);
                if (handleExists) {
                    showError('register-handle-error', '–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç');
                    return;
                }
                
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    await userCredential.user.updateProfile({ displayName: username });
                    
                    await db.collection('users').doc(userCredential.user.uid).set({
                        uid: userCredential.user.uid,
                        email: email,
                        displayName: username,
                        handle: handle,
                        photoURL: `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=00ff9d&color=000`,
                        status: 'online',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                } catch (error) {
                    showError('register-error', getAuthErrorMessage(error.code));
                }
            });
            
            // –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
            document.getElementById('google-login').addEventListener('click', async () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                try {
                    const result = await auth.signInWithPopup(provider);
                    const user = result.user;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –±–∞–∑–µ
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (!userDoc.exists) {
                        await db.collection('users').doc(user.uid).set({
                            uid: user.uid,
                            email: user.email,
                            displayName: user.displayName,
                            handle: '@' + user.email.split('@')[0],
                            photoURL: user.photoURL,
                            status: 'online',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    
                    showNotification('–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google —É—Å–ø–µ—à–µ–Ω!', 'success');
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google: ' + error.message, 'error');
                }
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
            document.getElementById('forgot-password').addEventListener('click', async (e) => {
                e.preventDefault();
                const email = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è:');
                if (email) {
                    try {
                        await auth.sendPasswordResetEmail(email);
                        showNotification('–ü–∏—Å—å–º–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ ' + email, 'success');
                    } catch (error) {
                        showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                    }
                }
            });
            
            // –ù–æ–≤—ã–π —á–∞—Ç
            document.getElementById('new-chat-btn').addEventListener('click', () => {
                showNewChatModal();
            });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('settings-btn').addEventListener('click', () => {
                showSettingsModal();
            });
            
            document.getElementById('close-settings').addEventListener('click', () => {
                hideSettingsModal();
            });
            
            document.getElementById('cancel-settings').addEventListener('click', () => {
                hideSettingsModal();
            });
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            document.getElementById('save-settings').addEventListener('click', async () => {
                await saveSettings();
            });
            
            // –í—ã—Ö–æ–¥
            document.getElementById('logout-btn').addEventListener('click', () => {
                auth.signOut();
            });
            
            // –ú–µ–Ω—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            document.getElementById('menu-toggle').addEventListener('click', () => {
                document.querySelector('.sidebar').classList.toggle('active');
            });
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('send-btn').addEventListener('click', sendMessage);
            document.getElementById('message-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        }
        
        // ========== –†–ê–ë–û–¢–ê –° –ß–ê–¢–ê–ú–ò ==========
        async function loadChats() {
            const chatsList = document.getElementById('chats-list');
            chatsList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-muted);">–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤...</div>';
            
            try {
                const snapshot = await db.collection('chats')
                    .where('participants', 'array-contains', currentUser.uid)
                    .orderBy('lastMessage.timestamp', 'desc')
                    .get();
                
                if (snapshot.empty) {
                    chatsList.innerHTML = '<div style="padding: 40px; text-align: center; color: var(--text-muted);">–ù–µ—Ç —á–∞—Ç–æ–≤</div>';
                    return;
                }
                
                chatsList.innerHTML = '';
                snapshot.forEach(doc => {
                    displayChat(doc.id, doc.data());
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:', error);
                chatsList.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--danger);">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
            }
        }
        
        async function displayChat(chatId, chat) {
            const partnerId = chat.participants.find(id => id !== currentUser.uid);
            let partnerData = {};
            
            if (partnerId) {
                const partnerDoc = await db.collection('users').doc(partnerId).get();
                if (partnerDoc.exists) {
                    partnerData = partnerDoc.data();
                }
            }
            
            const chatEl = document.createElement('div');
            chatEl.className = 'chat-item';
            chatEl.dataset.chatId = chatId;
            
            chatEl.innerHTML = `
                <img src="${partnerData.photoURL || 'https://ui-avatars.com/api/?name=User&background=7700ff&color=fff'}" style="width: 40px; height: 40px; border-radius: 50%;">
                <div style="flex: 1;">
                    <div style="font-weight: bold;">${partnerData.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
                    <div style="font-size: 12px; color: var(--text-muted);">${chat.lastMessage?.text || '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π'}</div>
                </div>
            `;
            
            chatEl.addEventListener('click', () => openChat(chatId, partnerId, partnerData));
            document.getElementById('chats-list').appendChild(chatEl);
        }
        
        async function openChat(chatId, partnerId, partnerData = null) {
            currentChatId = chatId;
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
            if (!partnerData && partnerId) {
                const partnerDoc = await db.collection('users').doc(partnerId).get();
                partnerData = partnerDoc.data();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            if (partnerData) {
                document.getElementById('partner-name').textContent = partnerData.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('partner-avatar').src = partnerData.photoURL || 'https://ui-avatars.com/api/?name=User&background=7700ff&color=fff';
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('message-input').disabled = false;
            document.getElementById('send-btn').disabled = false;
            document.getElementById('message-input').focus();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            loadMessages(chatId);
        }
        
        async function loadMessages(chatId) {
            const messagesList = document.getElementById('messages-list');
            messagesList.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-muted);">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>';
            
            try {
                const snapshot = await db.collection('messages')
                    .where('chatId', '==', chatId)
                    .orderBy('timestamp', 'asc')
                    .get();
                
                messagesList.innerHTML = '';
                
                if (snapshot.empty) {
                    messagesList.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-muted);">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    displayMessage(doc.data());
                });
                
                scrollToBottom();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
            }
        }
        
        function displayMessage(message) {
            const messagesList = document.getElementById('messages-list');
            const isSent = message.senderId === currentUser.uid;
            
            const messageEl = document.createElement('div');
            messageEl.className = `message ${isSent ? 'sent' : 'received'}`;
            
            const time = message.timestamp?.toDate ? message.timestamp.toDate() : new Date();
            const timeStr = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageEl.innerHTML = `
                <div>${message.text}</div>
                <div class="message-time">${timeStr}</div>
            `;
            
            messagesList.appendChild(messageEl);
        }
        
        async function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (!text || !currentChatId) return;
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                await db.collection('messages').add({
                    chatId: currentChatId,
                    senderId: currentUser.uid,
                    text: text,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
                await db.collection('chats').doc(currentChatId).update({
                    'lastMessage.text': text,
                    'lastMessage.timestamp': firebase.firestore.FieldValue.serverTimestamp(),
                    'lastMessage.senderId': currentUser.uid
                });
                
                input.value = '';
                scrollToBottom();
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
            }
        }
        
        async function showNewChatModal() {
            const searchTerm = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ @–Ω–∏–∫–Ω–µ–π–º –¥–ª—è –ø–æ–∏—Å–∫–∞:');
            if (!searchTerm) return;
            
            try {
                // –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º—É
                const snapshot = await db.collection('users')
                    .where('uid', '!=', currentUser.uid)
                    .get();
                
                const users = [];
                snapshot.forEach(doc => {
                    const user = doc.data();
                    if (user.displayName.toLowerCase().includes(searchTerm.toLowerCase()) || 
                        user.handle.toLowerCase().includes(searchTerm.toLowerCase())) {
                        users.push(user);
                    }
                });
                
                if (users.length === 0) {
                    showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                let userList = '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n\n';
                users.forEach((user, index) => {
                    userList += `${index + 1}. ${user.displayName} (${user.handle})\n`;
                });
                
                const choice = prompt(userList + '\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:');
                const index = parseInt(choice) - 1;
                
                if (index >= 0 && index < users.length) {
                    await createChat(users[index].uid);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞', 'error');
            }
        }
        
        async function createChat(partnerId) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —á–∞—Ç
                const existingChat = await db.collection('chats')
                    .where('participants', 'array-contains', currentUser.uid)
                    .get();
                
                for (const doc of existingChat.docs) {
                    const chat = doc.data();
                    if (chat.participants.includes(partnerId)) {
                        // –ß–∞—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
                        const partnerDoc = await db.collection('users').doc(partnerId).get();
                        openChat(doc.id, partnerId, partnerDoc.data());
                        return;
                    }
                }
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —á–∞—Ç
                const chatRef = await db.collection('chats').add({
                    participants: [currentUser.uid, partnerId],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastMessage: {
                        text: '–ß–∞—Ç —Å–æ–∑–¥–∞–Ω',
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        senderId: currentUser.uid
                    }
                });
                
                const partnerDoc = await db.collection('users').doc(partnerId).get();
                openChat(chatRef.id, partnerId, partnerDoc.data());
                
                showNotification('–ß–∞—Ç —Å–æ–∑–¥–∞–Ω!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞', 'error');
            }
        }
        
        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        function showSettingsModal() {
            document.getElementById('settings-modal').classList.remove('hidden');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            document.getElementById('settings-username').value = currentUser.displayName || '';
            
            // –ü–æ–ª—É—á–∞–µ–º handle –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
            loadUserSettings();
        }
        
        function hideSettingsModal() {
            document.getElementById('settings-modal').classList.add('hidden');
            clearSettingsErrors();
        }
        
        async function loadUserSettings() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    document.getElementById('settings-handle').value = userData.handle || '';
                    document.getElementById('settings-avatar').value = userData.photoURL || '';
                    document.getElementById('settings-status').value = userData.status || 'online';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            }
        }
        
        function clearSettingsErrors() {
            ['settings-username-error', 'settings-handle-error', 'settings-avatar-error'].forEach(id => {
                document.getElementById(id).textContent = '';
                document.getElementById(id).style.display = 'none';
            });
        }
        
        async function saveSettings() {
            clearSettingsErrors();
            
            const username = document.getElementById('settings-username').value.trim();
            const handle = document.getElementById('settings-handle').value.trim();
            const avatar = document.getElementById('settings-avatar').value.trim();
            const status = document.getElementById('settings-status').value;
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!username) {
                showError('settings-username-error', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
                return;
            }
            
            if (!handle || !handle.startsWith('@')) {
                showError('settings-handle-error', '–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ handle (–∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
            const handleExists = await checkHandleExists(handle, currentUser.uid);
            if (handleExists) {
                showError('settings-handle-error', '–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç');
                return;
            }
            
            if (avatar && !isValidUrl(avatar)) {
                showError('settings-avatar-error', '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞');
                return;
            }
            
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤ Firebase Auth
                await currentUser.updateProfile({
                    displayName: username,
                    photoURL: avatar || null
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤ Firestore
                await db.collection('users').doc(currentUser.uid).update({
                    displayName: username,
                    handle: handle,
                    photoURL: avatar || currentUser.photoURL,
                    status: status
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateUserUI();
                hideSettingsModal();
                showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
            }
        }
        
        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function showAuthScreen() {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }
        
        function showMainApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
        }
        
        function getAuthErrorMessage(code) {
            const messages = {
                'auth/invalid-email': '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email',
                'auth/user-disabled': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª—é—á–µ–Ω',
                'auth/user-not-found': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω',
                'auth/wrong-password': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å',
                'auth/email-already-in-use': 'Email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è',
                'auth/weak-password': '–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±—ã–π',
                'auth/operation-not-allowed': '–û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞',
                'auth/popup-closed-by-user': '–í—Ö–æ–¥ –æ—Ç–º–µ–Ω–µ–Ω',
                'auth/cancelled-popup-request': '–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å',
                'auth/popup-blocked': '–í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'
            };
            
            return messages[code] || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞';
        }
        
        async function checkHandleExists(handle, excludeUserId = null) {
            try {
                const snapshot = await db.collection('users')
                    .where('handle', '==', handle)
                    .get();
                
                if (snapshot.empty) return false;
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –∏—Å–∫–ª—é—á–∞–µ–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ –æ–Ω
                if (excludeUserId) {
                    return snapshot.docs.some(doc => doc.id !== excludeUserId);
                }
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∏–∫–Ω–µ–π–º–∞:', error);
                return false;
            }
        }
        
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }
        
        function scrollToBottom() {
            const container = document.getElementById('messages-container');
            container.scrollTop = container.scrollHeight;
        }
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', () => {
            initAuth();
            initUI();
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                updateUserStatus('offline');
            }
        });
    </script>
</body>
</html>